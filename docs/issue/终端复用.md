## 问题总结

### 根本原因

在 TaskLifecycleManager.dispose() 方法中 缺少了终端释放的调用 ，导致：

1. 终端无法释放 ：任务结束时，终端的 taskId 没有被清除
2. 终端无法复用 ：由于 taskId 仍然存在，其他任务无法复用这些终端
3. 终端泄漏 ：每次执行命令都创建新终端，导致终端数量不断增加

### 修复内容

在 src/core/task/managers/TaskLifecycleManager.ts 中进行了两处修改：

1. 添加导入（第 11 行）
```
import { TerminalRegistry } from 
"../../../integrations/terminal/
TerminalRegistry"
``` 

2. 在 dispose() 方法中添加终端释放调用（第 289 行）
```
async dispose(): Promise<void> {
    // ... 现有代码 ...
    
    TerminalRegistry.
    releaseTerminalsForTask(this.
    taskId)
}
```

### 工作原理

TerminalRegistry.releaseTerminalsForTask() 方法（ src/integrations/terminal/TerminalRegistry.ts:284 ）会：

1. 遍历所有终端
2. 找到 taskId 匹配的终端
3. 将这些终端的 taskId 设置为 undefined
4. 这样终端就可以被其他任务复用了

### 终端复用逻辑

修复后，终端复用将按以下优先级工作：

1. 第一优先级 ：查找已分配给当前任务且目录匹配的终端（ taskId 匹配）
2. 第二优先级 ：查找任何可用（ taskId === undefined ）且目录匹配的终端
3. 创建新终端 ：如果没有找到合适的终端，则创建新的